<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>患者信息表</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" th:href="@{/lib/layui-v2.6.3/css/layui.css}" media="all">
    <link rel="stylesheet" th:href="@{/css/public.css}" media="all">
    <link rel="stylesheet" th:href="@{/js/lay-module/step-lay/step.css}" media="all">
    <style>
        #pAllergicHistory{
            margin: 0px 14.5469px 0px 0px;
            height: 200px;
            width: 800px;
            resize: none;
        }
    </style>
</head>
<body>
<form class="layuimini-form layui-form">
    <fieldset class="layui-elem-field layui-field-title">
        <legend>患者信息</legend>
        <br>&emsp;
        <button type="button" lay-submit="" class="layui-btn layui-btn-sm" lay-filter="save">立即提交</button>
    </fieldset>
    <div class="layui-tab layui-tab-card">
        <ul class="layui-tab-title">
            <li class="layui-this" id="p1">基本信息(必填)</li>
            <li id="p2">家族病史和既往史(选填)</li>
        </ul>
        <div class="layui-tab-content" style="height: 600px">
            <div class="layui-tab-item layui-show" id="p11">
                <div class="layui-form layuimini-form">
                    <div class="layui-form-item">
                        <label class="layui-form-label required">患者姓名</label>
                        <div class="layui-input-block">
                            <input type="text" name="pName" lay-verify="required" placeholder="请输入患者姓名"
                                   class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required">患者性别</label>
                        <div class="layui-input-block" style="width: 140px">
                            <input type="radio" name="pGender" title="男" value="0" class="layui-input" checked>
                            <input type="radio" name="pGender" title="女" value="1" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required">联系方式</label>
                        <div class="layui-input-block">
                            <input type="text" name="pPhone" lay-verify="pPhone" placeholder="请输入手机号码"
                                   class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required">身份证号码</label>
                        <div class="layui-input-block">
                            <input type="text" name="pIc" lay-verify="pIc" placeholder="请输入身份证号码"
                                   class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required">出生日期</label>
                        <div class="layui-input-block">
                            <input type="date" name="pBirth" id="date" lay-verify="required" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required">婚姻状况</label>
                        <div class="layui-input-block">
                            <input type="radio" name="pMariage" value="0" title="已婚" checked>
                            <input type="radio" name="pMariage" value="1" title="未婚">
                            <input type="radio" name="pMariage" value="2" title="离异">
                            <input type="radio" name="pMariage" value="3" title="丧偶">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required">家庭住址</label>
                        <div class="layui-input-block">
                            <input type="text" name="pHome" placeholder="请输入家庭住址" lay-verify="required"
                                   class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">平时就诊医生</label>
                        <div class="layui-input-block">
                            <input type="text" name="pDayPhysican" placeholder="请输入平时就诊医生" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required">最近一次体检时间</label>
                        <div class="layui-input-block">
                            <input type="date" lay-verify="required" name="pHealthExamTime" id="date1" class="layui-input">
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-tab-item" id="p21">
                <div class="layui-form layuimini-form">
                    <div class="layui-form-item" id="app1">
                        <div class="layui-form-label">家族史</div>
                        <div class="layui-input-block">
                            <input type="checkbox" value="高血压" title="高血压" name="pFamilyHistory">
                            <input type="checkbox" value="糖尿病" title="糖尿病" name="pFamilyHistory">
                            <input type="checkbox" value="高尿酸血症/痛风" title="高尿酸血症/痛风" name="pFamilyHistory">
                            <input type="checkbox" value="心脏病" title="心脏病" name="pFamilyHistory">
                            <input type="checkbox" value="中风" title="中风" name="pFamilyHistory">
                            <input type="checkbox" value="肾病" title="肾病" name="pFamilyHistory">
                            <input type="checkbox" value="胃炎/胃溃疡" title="胃炎/胃溃疡" name="pFamilyHistory">
                            <input type="checkbox" value="癌症" title="癌症" name="pFamilyHistory">
                            <input type="checkbox" value="哮喘" title="哮喘" name="pFamilyHistory">
                            <input type="checkbox" value="慢阻肺" title="慢阻肺" name="pFamilyHistory">
                            <input type="checkbox" value="抑郁症" title="抑郁症" name="pFamilyHistory">
                            <input type="checkbox" value="肝炎" title="肝炎" name="pFamilyHistory">
<!--                            <input type="checkbox" value="" title="其它" name="pFamilyHistory" lay-filter="pmh" id="other">-->
                        </div>
<!--                        <div class="layui-input-block">-->
<!--                            <input type="text" name="pFamilyHistory" id="pmh" class="layui-input layui-input-inline" disabled>-->
<!--                        </div>-->
                    </div>
                    <div class="layui-form-item">
                        <div class="layui-form-label">既往病史</div>
                        <div class="layui-input-block">
                            <input type="checkbox" value="高血压" title="高血压" name="pPastMedicalHistory">
                            <input type="checkbox" value="糖尿病" title="糖尿病" name="pPastMedicalHistory">
                            <input type="checkbox" value="高脂血症" title="高脂血症" name="pPastMedicalHistory">
                            <input type="checkbox" value="高尿酸血症/痛风" title="高尿酸血症/痛风" name="pPastMedicalHistory">
                            <input type="checkbox" value="脑梗死" title="脑梗死" name="pPastMedicalHistory">
                            <input type="checkbox" value="冠心病" title="冠心病" name="pPastMedicalHistory">
                            <input type="checkbox" value="心律失常" title="心律失常" name="pPastMedicalHistory">
                            <input type="checkbox" value="肾病" title="肾病" name="pPastMedicalHistory">
                            <input type="checkbox" value="胃炎/胃溃疡" title="胃炎/胃溃疡" name="pPastMedicalHistory">
                            <input type="checkbox" value="肝炎" title="肝炎" name="pPastMedicalHistory">
                            <input type="checkbox" value="癌症" title="癌症" name="pPastMedicalHistory">
                            <input type="checkbox" value="哮喘" title="哮喘" name="pPastMedicalHistory">
                            <input type="checkbox" value="慢阻肺" title="慢阻肺" name="pPastMedicalHistory">
                            <input type="checkbox" value="甲亢/甲减" title="甲亢/甲减" name="pPastMedicalHistory">
                            <input type="checkbox" value="抑郁症" title="抑郁症" name="pPastMedicalHistory">
                            <input type="checkbox" value="焦虑" title="焦虑" name="pPastMedicalHistory">
                            <input type="checkbox" value="失眠" title="失眠" name="pPastMedicalHistory">
                            <input type="checkbox" value="骨质酥松" title="骨质酥松" name="pPastMedicalHistory">
<!--                            <input type="checkbox" value="其它" title="其它" name="pPastMedicalHistory" lay-filter="pmh1" id="other1">-->
                        </div>
<!--                        <div class="layui-input-block">-->
<!--                            <input type="text" name="pPastMedicalHistory" id="pmh1" class="layui-input layui-input-inline" disabled>-->
<!--                        </div>-->
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">过敏史</label>
                        <div class="layui-input-block">
                            <textarea type="text" id="pAllergicHistory" name="pAllergicHistory" placeholder="请输入过敏史(药物和食物)" class="layui-input">

                            </textarea>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</form>
<script th:src="@{/lib/layui-v2.6.3/layui.js}" charset="utf-8"></script>
<script th:src="@{/js/lay-config.js?v=1.0.4}" charset="utf-8"></script>
<script th:src="@{/lib/jquery-3.4.1/jquery-3.4.1.min.js}" charset="utf-8"></script>
<script>
    layui.use(['form', 'step', 'laydate'], function () {
        var $ = layui.jquery,
            form = layui.form,
            step = layui.step,
            laydate = layui.laydate;

        //日期
        laydate.render({
            elem: '#date',
            format: 'yyyy-MM-dd'
        });
        laydate.render({
            elem: '#date1',
            format: 'yyyy-MM-dd'
        });

        form.verify({
            pPhone:function (value,item){
                if(value.length == 0){
                    return "手机号不能为空";
                }
                if(!(/^1[3-9]{1}[0-9]{9}$/.test(value))) {
                    return "手机号格式不正确!";
                }
            },
            pIc:function (value,item){
                if(value.length == 0){
                    return "身份证不能为空";
                }
                if(!(/(^\d{15}$)|(^\d{17}(x|X|\d)$)/).test(value)){
                    return "身份证格式不正确";
                }
            }
        });

        // form.on('checkbox(pmh)', function (data) {
        //     if (data.elem.checked) {
        //         document.getElementById("pmh").disabled = false;
        //     } else {
        //         document.getElementById("pmh").disabled = true;
        //     }
        // });
        //
        // form.on('checkbox(pmh1)', function (data) {
        //     if (data.elem.checked) {
        //         document.getElementById("pmh1").disabled = false;
        //     } else {
        //         document.getElementById("pmh1").disabled = true;
        //     }
        // });

        form.on('submit(save)',function (data) {
            var arr1 = new Array();
            var arr2 = new Array();
            $("input:checkbox[name='pPastMedicalHistory']:checked").each(function (i) {
                arr2.push($(this).val());
            })
            data.field.pPastMedicalHistory = arr2.join(',');
            $("input:checkbox[name='pFamilyHistory']:checked").each(function (i) {
                arr1.push($(this).val());
            })
            data.field.pFamilyHistory = arr1.join(',');
            console.log(data.field.pPastMedicalHistory);
            $.ajax({
                url:'/app/GenSys/add_patient.do',
                data:{
                    pName:data.field.pName,
                    pGender:data.field.pGender,
                    pPhone:data.field.pPhone,
                    pBirth:data.field.pBirth,
                    pMariage:data.field.pMariage,
                    pHome:data.field.pHome,
                    pDayPhysican:data.field.pDayPhysican,
                    pHealthExamTime:data.field.pHealthExamTime,
                    pFamilyHistory:data.field.pFamilyHistory,
                    pPastMedicalHistory:data.field.pPastMedicalHistory,
                    pAllergicHistory:data.field.pAllergicHistory,
                    pIc:data.field.pIc
                },
                method:'post',
                dataType:'json',
                success(res){
                    layer.msg(res.msg,{icon:res.code,time:800},function () {
                        location.reload();
                    })
                }
            })
            return false;
        });

    })
</script>
<script>
    $(document).ready(function () {
        $("ul").find("li").click(function (e) {
            let last_li_id = $(".layui-show").attr("id");
            var li_id = e.currentTarget.id;
            $("#" + last_li_id).attr("class", "layui-tab-item");
            $("#" + li_id + "1").addClass("layui-show");
            last_li_id = li_id;
        });

        // $("#pmh").on("input",function (e) {
        //     $("#other").val(e.delegateTarget.value);
        // })
        //
        // $("#pmh1").on("input",function (e) {
        //     $("#other1").val(e.delegateTarget.value);
        // })
    })
</script>
</body>
</html>